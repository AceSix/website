@use 'sass:color';
@use 'sass:math';

// An excellent open-source UI typeface with tall x-height from https://github.com/rsms/inter
// Do not use the outdated Google Fonts version
@import url('https://rsms.me/inter/inter.css');

// Fixme: combine font imports into one url for performance
@import url('https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,630;1,630&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,365;0,400;0,600&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Bebas+Neue:wght@400&display=swap');

// ================== Responsiveness

$critical-value: 370;
$low-value: 600;
$middle-value: 900;
$high-value: 1200;

$breakpoint: $low-value * 1px;

@function _linear($x1, $y1, $x2, $y2) {
  $gradient: math.div($y2 - $y1, $x2 - $x1);
  $offset: $y2 - $x2 * $gradient;
  @if $y1 < $y2 {
    @return clamp($y1 * 1px, $gradient * 100vw + $offset * 1px, $y2 * 1px);
  } @else {
    @return clamp($y2 * 1px, $gradient * 100vw + $offset * 1px, $y1 * 1px);
  }
}

// ================== Variables

$nav-bar-background-color: rgb(46, 46, 46);
$html-background-color: rgb(30, 30, 30);
$page-background-color: rgb(41, 41, 41);
$main-background-color: rgb(36, 36, 36);
$code-background-color: rgb(30, 30, 30);

$nav-bar-hover-background-color: color.mix($nav-bar-background-color, $html-background-color, 25%);
$nav-bar-box-shadow: 0 0 8px rgba(0, 0, 0, 0.2), 0 0 16px rgba(0, 0, 0, 0.2), 0 0 32px rgba(0, 0, 0, 0.2);
$logo-box-shadow: 4px 4px 8px 0 rgba(0, 0, 0, 0.2), 4px 4px 16px 0 rgba(0, 0, 0, 0.2);

$background-dot-spacing: 30px;
$background-dot-color: rgb(50, 50, 50);
$background-dot-size: 1.5px;

$nav-bar-height-value: 56;
$nav-bar-height: $nav-bar-height-value * 1px;

$page-margin: 0 auto;
$page-padding-top: 0;
$page-padding-right: 0;
$page-padding-bottom: 0;
$page-padding-left: 0;
$page-padding: $page-padding-top $page-padding-right $page-padding-bottom $page-padding-left;
$page-max-width: _linear($middle-value, $middle-value, $high-value, $middle-value + 40);
$page-divider-spacing: 20px;

$scroll-margin-top: _linear(
  $middle-value,
  20 + $nav-bar-height-value,
  $high-value,
  30 + $nav-bar-height-value
);
$main-padding-top: _linear($middle-value, 20, $high-value, 25);
$main-padding-right: _linear($middle-value, 20, $high-value, (20 + 30));
$main-padding-right-negative: _linear($middle-value, -20, $high-value, -(20 + 30));
$main-padding-left: 20px;
$main-padding-bottom: 25px;
$main-padding: $main-padding-top $main-padding-right $main-padding-bottom $main-padding-left;

$toc-padding-top: $main-padding-top;
$toc-padding-left: _linear($middle-value, 20, $high-value, (20 + 10));
$toc-padding-left-negative: _linear($middle-value, -20, $high-value, -(20 + 10));
$toc-padding-right: $main-padding-left;
$toc-padding-bottom: $main-padding-bottom;

$logo-font-family: 'Bebas Neue', ui-sans-serif, sans-serif;

$nav-bar-font-size: _linear($critical-value, 11, $low-value, 14);
$nav-bar-font-weight: 630;
$nav-item-padding: _linear($critical-value, 3, $low-value, 1) _linear($critical-value, 7, $low-value, 8) 0;

$header-font-family: 'Open Sans', ui-sans-serif, sans-serif;
$header-font-sizes: 30px 25px 19px 18px 17px 16px;
$header-font-weights: 630 630 630 630 630 630;
$header-line-height: 1.8;
$header-color: hsl(0, 0%, 87%);

$body-font-family: 'Inter Var', 'Inter', ui-sans-serif, sans-serif;
$body-font-size: 14px;
$body-font-weight: 351;
$body-font-weight-bold: 565;
$body-line-height: 1.75;
$body-color: color.scale($header-color, $lightness: -4%);
$body-color-bold: color.scale($header-color, $lightness: -2%);

$link-color: hsl(213, 100%, 72%);
$code-inline-link-color: hsl(213, 100%, 72%);

$toc-font-size: 11px;
$toc-font-weight: $body-font-weight;
$toc-line-height: $body-font-size * $body-line-height;
$toc-color: color.change($header-color, $alpha: 0.6);
$toc-hover-background-color: hsla(220, 90%, 75%, 0.05);
$toc-hover-color: $header-color;

$nav-bar-border-color: color.mix($header-color, $nav-bar-background-color, 10%);
$page-divider-color: color.mix($header-color, $page-background-color, 10%);
$page-border-color: $page-divider-color;
$header-edge-color: $page-divider-color;
$table-edge-color: $page-divider-color;
$toc-edge-color: color.mix($header-color, $page-background-color, 10%);

$table-cell-padding: 4px 8px;
$table-font-size: $body-font-size;

$code-font-family: 'Roboto Mono', ui-monospace, monospace;

$code-block-font-size: 13px;
$code-block-font-weight: 351;
$code-block-line-height: 1.75;
$code-block-border-radius: 8px;
$code-block-padding-vert: 14px;
$code-block-padding-horz: 20px;

$code-inline-padding: 0px 4px 1px 5px;
$code-inline-border-radius: 3px;
$code-inline-color: hsl(31, 75%, 60%);
$code-inline-background-color: color.change($html-background-color, $alpha: 0.8);
$code-inline-color-callout: hsl(31, 98%, 56%);
$code-inline-background-color-callout: rgba(0, 0, 0, 25%);

$code-highlight-edge-width: 4px;
$code-highlight-edge-color: hsl(220, 80%, 60%);
$code-highlight-background-color: hsla(220, 90%, 75%, 0.1);

$callout-border-radius: 8px;
$callout-padding: 13px 20px 14px;

$list-padding-left: 28px;
$list-item-padding-left: 4px;

$main-inner-spacing-vert: 14px;

$todo-red: hsl(0, 88%, 59%);
$todo-red-dark: hsl(0, 100%, 45%);

// ================== Mixins

@mixin header-text($header-level) {
  padding-bottom: 0.3em;

  border-bottom: 1px solid $header-edge-color;

  font-family: $header-font-family;
  font-size: nth($header-font-sizes, $header-level);
  font-weight: nth($header-font-weights, $header-level);
  line-height: $header-line-height;
  color: $header-color;
}

@mixin body-text($color: $body-color, $color-bold: $body-color-bold) {
  font-family: $body-font-family;
  font-size: $body-font-size;
  font-weight: $body-font-weight;
  line-height: $body-line-height;
  color: $color;

  i,
  em {
    font-style: italic;
  }

  b,
  strong {
    font-weight: $body-font-weight-bold;
    color: $color-bold;
  }
}

@mixin code-block-text {
  font-family: $code-font-family;
  font-size: $code-block-font-size;
  font-weight: $code-block-font-weight;
  line-height: $code-block-line-height;
}

@mixin code-inline-text {
  font-family: $code-font-family;
  font-size: 97%;
  font-weight: inherit;
  line-height: inherit;

  color: $code-inline-color;
  background-color: $code-inline-background-color;
  letter-spacing: -0.2px;
}

@mixin anchor-text($color, $hover-background-color: transparent, $hover-color: $color) {
  color: $color;

  text-decoration: underline;
  text-decoration-color: transparent;

  &:hover {
    text-decoration-color: color.scale($color, $alpha: -25%);
    background-color: $hover-background-color;
    color: $hover-color;
  }
}

// ================== General styles

.no-select {
  -webkit-touch-callout: none; /* iOS Safari */
  -webkit-user-select: none; /* Safari */
  -khtml-user-select: none; /* Konqueror HTML */
  -moz-user-select: none; /* Old versions of Firefox */
  -ms-user-select: none; /* Internet Explorer/Edge */
  user-select: none;
}

img {
  max-width: 100%;
  min-width: 0px;
}

figcaption {
  text-align: center;
}

a {
  word-break: break-all;
  @include anchor-text($link-color);

  code {
    color: $code-inline-link-color !important;
  }
}

a,
button {
  -webkit-tap-highlight-color: transparent;
}

a[href='todo'] {
  color: $todo-red !important;
}

.math-display {
  overflow-x: scroll;
}

// ================== Text

.image-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
}

slot.summarySlot,
summary {
  cursor: pointer;
}

// ================== Callouts

@mixin callout($background-color, $border-color, $content) {
  $background-color: color.mix($background-color, $main-background-color, 75%);
  $border-color: color.mix($border-color, $main-background-color, 75%);

  background-color: $background-color;
  border: 1px solid $border-color;

  > * {
    @include body-text(
      color.scale($header-color, $lightness: 15%),
      color.scale($header-color, $lightness: 30%)
    );

    margin-bottom: $main-inner-spacing-vert;
  }

  :not(pre) > code {
    color: $code-inline-color-callout;
    background-color: $code-inline-background-color-callout;
  }

  details {
    border-left: 1px solid $border-color;
    padding-left: $list-padding-left * 0.5;

    > summary {
      margin-left: -($list-padding-left * 0.5 + 1px);
      background-color: $background-color;
    }
    > * {
      margin-bottom: $main-inner-spacing-vert;
    }
  }

  @if ($content == 'Todo: ') {
    background-color: white;
    border: white;

    > :first-child::before {
      content: $content;
    }
  } @else if ($content != '') {
    &::before {
      content: $content;
      display: inline-block;

      margin-bottom: $main-inner-spacing-vert;

      font-weight: $body-font-weight-bold;
      color: color.scale($header-color, $lightness: 50%);
    }
  }

  > :last-child {
    margin-bottom: 0;
  }
}

.task-callout,
.warning-callout,
.success-callout,
.error-callout,
.todo-callout {
  border-radius: $callout-border-radius;
  padding: $callout-padding;

  &.task-callout {
    counter-increment: task;
    @include callout(hsl(210, 86%, 24.5%), hsl(210, 86%, 45%), 'Task ' counter(task) ':');
  }
  &.warning-callout {
    @include callout(hsl(40, 85%, 24%), hsl(40, 85%, 44%), '');
  }
  &.success-callout {
    @include callout(hsl(110, 52%, 20%), hsl(110, 52%, 35%), '');
  }
  &.error-callout {
    @include callout(hsl(3, 50%, 25%), hsl(356, 50%, 45%), '');
  }
  &.todo-callout {
    @include callout(white, white, 'Todo: ');
    border-radius: 0;
    > :only-child {
      color: $todo-red-dark !important;
    }
  }
}

// ================== Other

.rgb-color-picker {
  display: grid;
  grid-template-columns: min-content minmax(0, 1fr);
  gap: $main-inner-spacing-vert;
  place-items: stretch;

  width: 100%;

  user-select: none;

  > * {
    border-radius: $code-block-border-radius !important;
    color: black;
  }

  > .rgb-color-picker-display {
    border: 1px solid white;
  }
}
// ================== Tables

table {
  border-collapse: collapse;
  font-size: $table-font-size;
}

td,
th {
  border: 1px solid $table-edge-color;
  padding: $table-cell-padding;
}

th {
  font-weight: $body-font-weight-bold;
}
